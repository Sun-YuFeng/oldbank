# 银龄通后台管理系统接口文档

## 目录

- [1. 系统说明](#1-系统说明)
- [2. 管理员认证模块](#2-管理员认证模块)
- [3. 账号管理模块](#3-账号管理模块)
- [4. 用户管理模块](#4-用户管理模块)
- [5. 投诉管理模块](#5-投诉管理模块)
- [6. 志愿者管理模块](#6-志愿者管理模块)
- [7. 仪表盘模块](#7-仪表盘模块)
- [8. 文件上传模块](#8-文件上传模块)
- [9. 通用说明](#9-通用说明)

---

## 1. 系统说明

### 1.1 管理员分级

系统支持三级管理员权限：

| 级别 | 代码 | 权限说明 |
|-----|------|---------|
| 初级管理员 | JUNIOR_ADMIN | 可以查看不重要的数据，进行投诉的处理 |
| 高级管理员 | SENIOR_ADMIN | 可以审核初级管理员的任命 |
| 最高权限管理员 | SUPER_ADMIN | 可以任命高级管理员 |

### 1.2 审核状态

- `0`: 待审核
- `1`: 已通过
- `2`: 未通过

### 1.3 初始账号

系统启动时会自动创建最高权限管理员：
- 用户名: `superadmin`
- 密码: `superadmin123`
- 手机号: `13900000000`

### 1.4 基础URL

```
http://localhost:8080/silveragepass
```

---

## 2. 管理员认证模块

### 2.1 管理员注册

**接口地址**
```
POST /api/admin/auth/register
```

**请求参数**
```json
{
  "username": "admin001",
  "password": "password123",
  "phone": "13812345678"
}
```

**参数说明**

| 参数 | 类型 | 必填 | 说明 |
|-----|------|-----|------|
| username | String | 是 | 用户名，长度3-50字符 |
| password | String | 是 | 密码，长度6-120字符 |
| phone | String | 是 | 手机号，11位数字 |

**响应示例**
```json
{
  "code": 200,
  "message": "注册成功，请等待管理员审核",
  "data": "注册成功，请等待管理员审核",
  "timestamp": "2025-10-25 10:00:00"
}
```

---

### 2.2 管理员登录

**接口地址**
```
POST /api/admin/auth/login
```

**请求参数**
```json
{
  "username": "superadmin",
  "password": "superadmin123"
}
```

**参数说明**

| 参数 | 类型 | 必填 | 说明 |
|-----|------|-----|------|
| username | String | 是 | 用户名 |
| password | String | 是 | 密码 |

**响应示例**
```json
{
  "code": 200,
  "message": "登录成功",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "username": "superadmin",
    "phone": "13900000000",
    "adminLevel": "SUPER_ADMIN",
    "adminLevelDesc": "最高权限管理员"
  },
  "timestamp": "2025-10-25 10:00:00"
}
```

**错误响应**
```json
{
  "code": 400,
  "message": "账号正在审核中，请等待审核通过",
  "data": null,
  "timestamp": "2025-10-25 10:00:00"
}
```

---

### 2.3 获取待审核的管理员账号列表

**接口地址**
```
GET /api/admin/auth/pending
```

**请求头**
```
Authorization: Bearer {token}
```

**响应示例**
```json
{
  "code": 200,
  "message": "success",
  "data": [
    {
      "id": 2,
      "username": "admin001",
      "phone": "13812345678",
      "approvalStatus": 0,
      "approvalStatusText": "待审核",
      "adminLevel": "JUNIOR_ADMIN",
      "adminLevelDesc": "初级管理员",
      "approvedByName": null,
      "approvalTime": null,
      "approvalRemark": null,
      "createTime": "2025-10-25 09:30:00"
    }
  ],
  "timestamp": "2025-10-25 10:00:00"
}
```

---

### 2.4 获取所有管理员账号列表

**接口地址**
```
GET /api/admin/auth/accounts
```

**请求头**
```
Authorization: Bearer {token}
```

**响应示例**
```json
{
  "code": 200,
  "message": "success",
  "data": [
    {
      "id": 1,
      "username": "superadmin",
      "phone": "13900000000",
      "approvalStatus": 1,
      "approvalStatusText": "已通过",
      "adminLevel": "SUPER_ADMIN",
      "adminLevelDesc": "最高权限管理员",
      "approvedByName": null,
      "approvalTime": null,
      "approvalRemark": null,
      "createTime": "2025-10-25 00:00:00"
    }
  ],
  "timestamp": "2025-10-25 10:00:00"
}
```

---

### 2.5 审核管理员账号

**接口地址**
```
POST /api/admin/auth/approve/{id}
```

**请求头**
```
Authorization: Bearer {token}
```

**路径参数**

| 参数 | 类型 | 必填 | 说明 |
|-----|------|-----|------|
| id | Long | 是 | 待审核账号的ID |

**请求参数**
```json
{
  "approvalStatus": 1,
  "remark": "审核通过",
  "adminLevel": "JUNIOR_ADMIN"
}
```

**参数说明**

| 参数 | 类型 | 必填 | 说明 |
|-----|------|-----|------|
| approvalStatus | Integer | 是 | 审核状态：1=通过，2=拒绝 |
| remark | String | 否 | 审核备注 |
| adminLevel | String | 否 | 任命的管理员级别（通过时可指定）：JUNIOR_ADMIN/SENIOR_ADMIN |

**权限要求**
- 审核初级管理员（JUNIOR_ADMIN）：需要高级管理员或最高权限管理员
- 任命高级管理员（SENIOR_ADMIN）：需要最高权限管理员

**响应示例（成功）**
```json
{
  "code": 200,
  "message": "审核通过成功",
  "data": "审核通过成功",
  "timestamp": "2025-10-25 10:00:00"
}
```

**响应示例（权限不足）**
```json
{
  "code": 400,
  "message": "只有最高权限管理员可以任命高级管理员",
  "data": null,
  "timestamp": "2025-10-25 10:00:00"
}
```

---

### 2.6 获取当前登录的管理员信息

**接口地址**
```
GET /api/admin/auth/me
```

**请求头**
```
Authorization: Bearer {token}
```

**响应示例**
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "id": 1,
    "username": "superadmin",
    "phone": "13900000000",
    "approvalStatus": 1,
    "approvalStatusText": "已通过",
    "adminLevel": "SUPER_ADMIN",
    "adminLevelDesc": "最高权限管理员",
    "approvedByName": null,
    "approvalTime": null,
    "approvalRemark": null,
    "createTime": "2025-10-25 00:00:00"
  },
  "timestamp": "2025-10-25 10:00:00"
}
```

---

## 3. 账号管理模块

### 3.1 获取待审核账号列表

**接口地址**
```
GET /api/accounts/pending
```

**请求头**
```
Authorization: Bearer {token}
```

**权限要求**
- 需要 ADMIN 角色

**响应示例**
```json
{
  "code": 200,
  "message": "success",
  "data": [
    {
      "id": 5,
      "username": "newuser001",
      "phone": "13812345678",
      "email": "newuser@example.com",
      "registerTime": "2025-10-25 09:30",
      "avatar": "https://example.com/avatar.jpg"
    }
  ],
  "timestamp": "2025-10-25 10:00:00"
}
```

---

### 3.2 获取活跃账号列表

**接口地址**
```
GET /api/accounts/active
```

**请求头**
```
Authorization: Bearer {token}
```

**权限要求**
- 需要 ADMIN 角色

**响应示例**
```json
{
  "code": 200,
  "message": "success",
  "data": [
    {
      "id": 1,
      "username": "user001",
      "phone": "13812345678",
      "email": "user001@example.com",
      "registerTime": "2025-10-20 10:00",
      "avatar": "https://example.com/avatar.jpg",
      "role": "volunteer",
      "status": "active",
      "statusText": "活跃"
    }
  ],
  "timestamp": "2025-10-25 10:00:00"
}
```

---

### 3.3 批准账号

**接口地址**
```
POST /api/accounts/{id}/approve
```

**请求头**
```
Authorization: Bearer {token}
```

**路径参数**

| 参数 | 类型 | 必填 | 说明 |
|-----|------|-----|------|
| id | Long | 是 | 账号ID |

**权限要求**
- 需要 ADMIN 角色

**响应示例**
```json
{
  "code": 200,
  "message": "账号已批准",
  "data": "账号已批准",
  "timestamp": "2025-10-25 10:00:00"
}
```

---

### 3.4 拒绝账号

**接口地址**
```
POST /api/accounts/{id}/reject
```

**请求头**
```
Authorization: Bearer {token}
```

**路径参数**

| 参数 | 类型 | 必填 | 说明 |
|-----|------|-----|------|
| id | Long | 是 | 账号ID |

**权限要求**
- 需要 ADMIN 角色

**响应示例**
```json
{
  "code": 200,
  "message": "账号已拒绝",
  "data": "账号已拒绝",
  "timestamp": "2025-10-25 10:00:00"
}
```

---

### 3.5 更新账号角色

**接口地址**
```
PUT /api/accounts/{id}/role
```

**请求头**
```
Authorization: Bearer {token}
```

**路径参数**

| 参数 | 类型 | 必填 | 说明 |
|-----|------|-----|------|
| id | Long | 是 | 账号ID |

**请求参数**
```json
{
  "role": "volunteer"
}
```

**参数说明**

| 参数 | 类型 | 必填 | 说明 |
|-----|------|-----|------|
| role | String | 是 | 角色：admin/volunteer/user |

**权限要求**
- 需要 ADMIN 角色

**响应示例**
```json
{
  "code": 200,
  "message": "角色已更新",
  "data": "角色已更新",
  "timestamp": "2025-10-25 10:00:00"
}
```

---

## 4. 用户管理模块

### 4.1 获取用户列表（分页、搜索、筛选）

**接口地址**
```
GET /api/users
```

**请求头**
```
Authorization: Bearer {token}
```

**查询参数**

| 参数 | 类型 | 必填 | 默认值 | 说明 |
|-----|------|-----|--------|------|
| page | Integer | 否 | 1 | 页码 |
| pageSize | Integer | 否 | 9 | 每页数量 |
| search | String | 否 | - | 搜索关键字（用户名、手机号） |
| role | String | 否 | - | 角色筛选 |
| status | String | 否 | - | 状态筛选 |

**权限要求**
- 需要 ADMIN 角色

**响应示例**
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "total": 100,
    "page": 1,
    "pageSize": 9,
    "totalPages": 12,
    "items": [
      {
        "id": 1,
        "username": "张三",
        "phone": "13812345678",
        "role": "志愿者",
        "credit": 1500,
        "status": "活跃",
        "registerTime": "2025-10-20",
        "avatar": "https://example.com/avatar.jpg"
      }
    ]
  },
  "timestamp": "2025-10-25 10:00:00"
}
```

---

### 4.2 获取近期创号人数统计

**接口地址**
```
GET /api/users/creation-stats
```

**请求头**
```
Authorization: Bearer {token}
```

**查询参数**

| 参数 | 类型 | 必填 | 默认值 | 说明 |
|-----|------|-----|--------|------|
| days | Integer | 否 | 7 | 统计天数 |

**权限要求**
- 需要 ADMIN 角色

**响应示例**
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "dates": ["10-19", "10-20", "10-21", "10-22", "10-23", "10-24", "10-25"],
    "counts": [5, 8, 6, 10, 7, 9, 12]
  },
  "timestamp": "2025-10-25 10:00:00"
}
```

---

### 4.3 获取用户角色分布统计

**接口地址**
```
GET /api/users/role-stats
```

**请求头**
```
Authorization: Bearer {token}
```

**权限要求**
- 需要 ADMIN 角色

**响应示例**
```json
{
  "code": 200,
  "message": "success",
  "data": [
    {
      "name": "志愿者",
      "value": 120
    },
    {
      "name": "老年人",
      "value": 200
    },
    {
      "name": "家属",
      "value": 80
    }
  ],
  "timestamp": "2025-10-25 10:00:00"
}
```

---

### 4.4 获取用户状态分布统计

**接口地址**
```
GET /api/users/status-stats
```

**请求头**
```
Authorization: Bearer {token}
```

**权限要求**
- 需要 ADMIN 角色

**响应示例**
```json
{
  "code": 200,
  "message": "success",
  "data": [
    {
      "name": "活跃",
      "value": 350
    },
    {
      "name": "禁用",
      "value": 20
    },
    {
      "name": "待审核",
      "value": 30
    }
  ],
  "timestamp": "2025-10-25 10:00:00"
}
```

---

## 5. 投诉管理模块

### 5.1 获取投诉列表（分页、搜索）

**接口地址**
```
GET /api/complaints
```

**请求头**
```
Authorization: Bearer {token}
```

**查询参数**

| 参数 | 类型 | 必填 | 默认值 | 说明 |
|-----|------|-----|--------|------|
| page | Integer | 否 | 1 | 页码 |
| pageSize | Integer | 否 | 10 | 每页数量 |
| search | String | 否 | - | 搜索关键字（标题、投诉人） |

**权限要求**
- 需要 ADMIN 角色

**响应示例**
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "total": 50,
    "page": 1,
    "pageSize": 10,
    "totalPages": 5,
    "items": [
      {
        "id": 1,
        "title": "服务质量投诉",
        "description": "志愿者服务态度不好",
        "author": "张三",
        "time": "2025-10-25 10:00:00",
        "image": "https://example.com/complaint.jpg",
        "status": "pending",
        "handler": null,
        "handleTime": null,
        "result": null
      }
    ]
  },
  "timestamp": "2025-10-25 10:00:00"
}
```

**状态说明**

| 状态值 | 说明 |
|--------|------|
| pending | 待处理 |
| resolved | 已处理 |

---

### 5.2 获取投诉详情

**接口地址**
```
GET /api/complaints/{id}
```

**请求头**
```
Authorization: Bearer {token}
```

**路径参数**

| 参数 | 类型 | 必填 | 说明 |
|-----|------|-----|------|
| id | Long | 是 | 投诉ID |

**权限要求**
- 需要 ADMIN 角色

**响应示例**
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "id": 1,
    "title": "服务质量投诉",
    "description": "志愿者服务态度不好，没有耐心",
    "author": "张三",
    "phone": "13812345678",
    "time": "2025-10-25 10:00:00",
    "images": [
      "https://example.com/complaint1.jpg",
      "https://example.com/complaint2.jpg"
    ],
    "status": "pending",
    "handler": null,
    "handleTime": null,
    "result": null
  },
  "timestamp": "2025-10-25 10:00:00"
}
```

---

### 5.3 处理投诉

**接口地址**
```
POST /api/complaints/{id}/handle
```

**请求头**
```
Authorization: Bearer {token}
```

**路径参数**

| 参数 | 类型 | 必填 | 说明 |
|-----|------|-----|------|
| id | Long | 是 | 投诉ID |

**请求参数**
```json
{
  "result": "已核实情况，已对相关志愿者进行教育",
  "status": "resolved"
}
```

**参数说明**

| 参数 | 类型 | 必填 | 说明 |
|-----|------|-----|------|
| result | String | 是 | 处理结果描述 |
| status | String | 是 | 状态：resolved |

**权限要求**
- 需要 ADMIN 角色

**响应示例**
```json
{
  "code": 200,
  "message": "投诉已处理",
  "data": "投诉已处理",
  "timestamp": "2025-10-25 10:00:00"
}
```

---

## 6. 志愿者管理模块

### 6.1 获取志愿者活跃度排名

**接口地址**
```
GET /api/volunteers/ranking
```

**请求头**
```
Authorization: Bearer {token}
```

**权限要求**
- 需要 ADMIN 角色

**响应示例**
```json
{
  "code": 200,
  "message": "success",
  "data": [
    {
      "rank": 1,
      "name": "李四",
      "avatar": "https://example.com/avatar.jpg",
      "serviceCount": 50,
      "serviceHours": 120
    },
    {
      "rank": 2,
      "name": "王五",
      "avatar": "https://example.com/avatar2.jpg",
      "serviceCount": 45,
      "serviceHours": 110
    }
  ],
  "timestamp": "2025-10-25 10:00:00"
}
```

---

## 7. 仪表盘模块

### 7.1 获取仪表盘统计数据

**接口地址**
```
GET /api/dashboard/stats
```

**请求头**
```
Authorization: Bearer {token}
```

**权限要求**
- 需要 ADMIN 角色

**响应示例**
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "totalServices": 1200,
    "activeVolunteers": 150,
    "warningAlerts": 5
  },
  "timestamp": "2025-10-25 10:00:00"
}
```

**字段说明**

| 字段 | 说明 |
|-----|------|
| totalServices | 总服务数 |
| activeVolunteers | 活跃志愿者数 |
| warningAlerts | 警告提醒数 |

---

### 7.2 获取服务趋势数据

**接口地址**
```
GET /api/dashboard/service-trend
```

**请求头**
```
Authorization: Bearer {token}
```

**查询参数**

| 参数 | 类型 | 必填 | 默认值 | 说明 |
|-----|------|-----|--------|------|
| days | Integer | 否 | 4 | 统计天数 |

**权限要求**
- 需要 ADMIN 角色

**响应示例**
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "dates": ["10-22", "10-23", "10-24", "10-25"],
    "serviceCounts": [25, 30, 28, 35]
  },
  "timestamp": "2025-10-25 10:00:00"
}
```

---

### 7.3 获取积分变动原因分布

**接口地址**
```
GET /api/dashboard/points-reason
```

**请求头**
```
Authorization: Bearer {token}
```

**权限要求**
- 需要 ADMIN 角色

**响应示例**
```json
{
  "code": 200,
  "message": "success",
  "data": [
    {
      "reason": "完成服务",
      "count": 500,
      "percentage": 50.0
    },
    {
      "reason": "接受服务",
      "count": 300,
      "percentage": 30.0
    },
    {
      "reason": "系统奖励",
      "count": 200,
      "percentage": 20.0
    }
  ],
  "timestamp": "2025-10-25 10:00:00"
}
```

---

## 8. 文件上传模块

### 8.1 上传头像/图片

**接口地址**
```
POST /api/upload/avatar
```

**请求头**
```
Authorization: Bearer {token}
Content-Type: multipart/form-data
```

**请求参数**

| 参数 | 类型 | 必填 | 说明 |
|-----|------|-----|------|
| file | File | 是 | 图片文件 |

**权限要求**
- 需要登录

**响应示例**
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "url": "https://example.com/uploads/avatar_123456.jpg",
    "filename": "avatar_123456.jpg",
    "size": 102400
  },
  "timestamp": "2025-10-25 10:00:00"
}
```

**注意事项**
- 支持的图片格式：JPG、JPEG、PNG、GIF
- 文件大小限制：10MB
- 上传后会自动进行图片压缩和优化

---

## 9. 通用说明

### 9.1 错误码说明

| 错误码 | 说明 |
|-------|------|
| 200 | 成功 |
| 400 | 请求参数错误或业务逻辑错误 |
| 401 | 未授权（token无效或过期） |
| 403 | 权限不足 |
| 404 | 资源不存在 |
| 500 | 服务器内部错误 |

### 9.2 分页响应格式

所有分页接口返回的数据格式如下：

```json
{
  "total": 100,
  "page": 1,
  "pageSize": 10,
  "totalPages": 10,
  "items": []
}
```

| 字段 | 说明 |
|-----|------|
| total | 总记录数 |
| page | 当前页码 |
| pageSize | 每页数量 |
| totalPages | 总页数 |
| items | 数据列表 |

### 9.3 时间格式

- 日期时间格式：`yyyy-MM-dd HH:mm:ss`
- 日期格式：`yyyy-MM-dd`
- 图表日期格式：`MM-dd`

### 9.4 Token使用说明

1. **获取Token**：通过登录接口获取token
2. **使用Token**：在后续请求中，需要在请求头中携带token：
   ```
   Authorization: Bearer {token}
   ```
3. **Token过期**：token默认有效期为24小时，过期后需要重新登录
4. **刷新Token**：暂不支持token刷新，过期后请重新登录

### 9.5 权限说明

系统采用基于角色的访问控制（RBAC）：

- **公开接口**：无需认证即可访问（注册、登录）
- **认证接口**：需要登录（`@PreAuthorize("isAuthenticated()")`）
- **管理员接口**：需要管理员权限（`@PreAuthorize("hasRole('ADMIN')")`）

### 9.6 使用示例

#### 示例1：完整的登录和获取用户列表流程

**步骤1：管理员登录**
```bash
curl -X POST http://localhost:8080/silveragepass/api/admin/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "username": "superadmin",
    "password": "superadmin123"
  }'
```

**步骤2：获取用户列表**
```bash
curl -X GET "http://localhost:8080/silveragepass/api/users?page=1&pageSize=10" \
  -H "Authorization: Bearer {token}"
```

#### 示例2：处理投诉流程

**步骤1：查看投诉列表**
```bash
curl -X GET "http://localhost:8080/silveragepass/api/complaints?page=1&pageSize=10" \
  -H "Authorization: Bearer {token}"
```

**步骤2：查看投诉详情**
```bash
curl -X GET http://localhost:8080/silveragepass/api/complaints/1 \
  -H "Authorization: Bearer {token}"
```

**步骤3：处理投诉**
```bash
curl -X POST http://localhost:8080/silveragepass/api/complaints/1/handle \
  -H "Authorization: Bearer {token}" \
  -H "Content-Type: application/json" \
  -d '{
    "result": "已核实情况，已对相关志愿者进行教育",
    "status": "resolved"
  }'
```

#### 示例3：上传图片

```bash
curl -X POST http://localhost:8080/silveragepass/api/upload/avatar \
  -H "Authorization: Bearer {token}" \
  -F "file=@/path/to/image.jpg"
```

### 9.7 开发注意事项

1. **跨域配置**：如果前端和后端不在同一域名，需要配置CORS
2. **文件上传**：上传文件时，Content-Type 必须为 `multipart/form-data`
3. **数据验证**：所有请求参数都会进行验证，请确保传递正确的数据格式
4. **异常处理**：所有接口都有统一的异常处理，返回格式统一
5. **日志记录**：系统会记录所有重要操作的日志

### 9.8 安全建议

1. **修改默认密码**：生产环境部署后，立即修改最高权限管理员的默认密码
2. **HTTPS**：生产环境建议使用HTTPS协议
3. **Token安全**：不要在URL中传递token，应使用请求头
4. **密码强度**：建议使用强密码（包含大小写字母、数字、特殊字符）
5. **定期备份**：定期备份数据库数据

---

## 附录：API快速索引

### 管理员认证
- `POST /api/admin/auth/register` - 管理员注册
- `POST /api/admin/auth/login` - 管理员登录
- `GET /api/admin/auth/pending` - 获取待审核管理员
- `GET /api/admin/auth/accounts` - 获取所有管理员
- `POST /api/admin/auth/approve/{id}` - 审核管理员
- `GET /api/admin/auth/me` - 获取当前管理员信息

### 账号管理
- `GET /api/accounts/pending` - 获取待审核账号
- `GET /api/accounts/active` - 获取活跃账号
- `POST /api/accounts/{id}/approve` - 批准账号
- `POST /api/accounts/{id}/reject` - 拒绝账号
- `PUT /api/accounts/{id}/role` - 更新账号角色

### 用户管理
- `GET /api/users` - 获取用户列表
- `GET /api/users/creation-stats` - 获取创号统计
- `GET /api/users/role-stats` - 获取角色分布
- `GET /api/users/status-stats` - 获取状态分布

### 投诉管理
- `GET /api/complaints` - 获取投诉列表
- `GET /api/complaints/{id}` - 获取投诉详情
- `POST /api/complaints/{id}/handle` - 处理投诉

### 志愿者管理
- `GET /api/volunteers/ranking` - 获取志愿者排名

### 仪表盘
- `GET /api/dashboard/stats` - 获取统计数据
- `GET /api/dashboard/service-trend` - 获取服务趋势
- `GET /api/dashboard/points-reason` - 获取积分原因分布

### 文件上传
- `POST /api/upload/avatar` - 上传头像/图片

---

**文档版本**: v1.0  
**最后更新**: 2025-10-25  
**联系方式**: 如有问题请联系技术支持

